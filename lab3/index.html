<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Explorer - Discover Your Next Read</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                     <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span class="text-2xl font-bold text-gray-900">Book Explorer</span>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-blue-600 font-semibold hover:text-blue-700 transition">Home</a>
                    <a href="favorites.html" class="text-gray-600 hover:text-blue-600 transition flex items-center gap-2">
                        Favorites
                        <span id="nav-favorites-badge" class="hidden bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full">0</span>
                    </a>
                    <a href="about.html" class="text-gray-600 hover:text-blue-600 transition">About</a>
                </div>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden text-gray-600 hover:text-blue-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 space-y-2">
                <a href="index.html" class="block text-blue-600 font-semibold py-2 px-4 rounded hover:bg-blue-50 transition">Home</a>
                <a href="favorites.html" class="block text-gray-600 py-2 px-4 rounded hover:bg-blue-50 transition">Favorites</a>
                <a href="about.html" class="block text-gray-600 py-2 px-4 rounded hover:bg-blue-50 transition">About</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="Hero relative text-white" style="background-image: url('../Images/coffee.jpg'); background-size: cover; background-position: center; background-blend-mode: overlay; background-color: rgba(0, 0, 0, 0.3);">
        <!-- Decorative Elements -->
        <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>
        <div class="absolute top-0 left-0 w-64 h-64 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute bottom-0 left-1/2 w-64 h-64 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
        
        <div class="container mx-auto px-4 py-20 md:py-32 relative">
            <div class="text-center max-w-4xl mx-auto">
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-extrabold mb-6 leading-tight">
                    Discover Your Next <br class="hidden md:block"/>
                    <span class="text-yellow-300">Great Read</span>
                </h1>
                <p class="text-xl md:text-2xl text-blue-100 mb-12 max-w-3xl mx-auto leading-relaxed">
                    Explore thousands of books, save your favorites, and find the perfect story for you.
                </p>
                
                <!-- Search Bar -->
                <div class="max-w-3xl mx-auto pb-2">
                    <div class="relative bg-white rounded-2xl shadow-2xl overflow-hidden">
                        <input 
                            type="text" 
                            id="search-input"
                            placeholder="Search for books by title, author, or topic..." 
                            class="w-full px-6 py-5 pr-40 text-gray-800 text-lg focus:outline-none"
                        >
                        <button 
                            id="search-btn"
                            class="absolute right-2 top-2 bottom-2 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold px-8 rounded-xl transition transform hover:scale-105 shadow-lg"
                        >
                            Search
                        </button>
                    </div>
                </div>
                 
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#books-grid" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full">
                    Browse Books
                </a>
                <a href="favorites.html" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-8 rounded-full transition">
                    View Favorites
                </a>
            </div>
        </div>
          
        <!-- Bottom Wave -->
        <div class="absolute bottom-0 left-0 right-0">
            <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full">
                <path d="M0 120L60 105C120 90 240 60 360 45C480 30 600 30 720 37.5C840 45 960 60 1080 67.5C1200 75 1320 75 1380 75L1440 75V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z" fill="#F9FAFB"/>
            </svg>
        </div>
    </section>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto px-4 py-8">
        <div class="mb-6 flex items-center justify-between">
            <div>
                <h2 id="results-title" class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Popular Books</h2>
                <p id="results-subtitle" class="text-gray-600">Browse our collection of amazing books</p>
            </div>
            <button id="clear-search-btn" class="hidden bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded transition">
                Clear Search
            </button>
        </div>

        <!-- Loading Spinner (Exercise 3.4) -->
        <div id="loading" class="hidden flex flex-col justify-center items-center py-16">
            <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"></div>
            <p class="text-gray-600 font-semibold">Loading books...</p>
        </div>

        <!-- No Results Message (Exercise 3.4) -->
        <div id="no-results" class="hidden text-center py-16">
            <svg class="w-20 h-20 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-2xl font-bold text-gray-700 mb-2">No books found</h3>
            <p class="text-gray-600 mb-6">Try a different search term or browse our popular books.</p>
            <button id="browse-popular-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition">
                Browse Popular Books
            </button>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="hidden text-center py-16">
            <svg class="w-20 h-20 text-red-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-2xl font-bold text-gray-700 mb-2">Oops! Something went wrong</h3>
            <p class="text-gray-600 mb-6">Unable to fetch books. Please try again later.</p>
            <button id="retry-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition">
                Retry
            </button>
        </div>

        <!-- Books Grid -->
        <div id="books-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Book cards will be populated here -->
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">Book Explorer</h3>
                    <p class="text-gray-400">Your gateway to discovering amazing books from around the world.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-white transition">Home</a></li>
                        <li><a href="favorites.html" class="text-gray-400 hover:text-white transition">Favorites</a></li>
                        <li><a href="about.html" class="text-gray-400 hover:text-white transition">About</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Terms of Service</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>&copy; 2025 Book Explorer. Powered by Open Library API.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        // ===== Exercise 3.1: fetchBooks.js Module (API Module) =====
        const API_BASE_URL = 'https://openlibrary.org';

        // Fetch books by search query
        async function searchBooks(query, limit = 20) {
            try {
                const response = await fetch(
                    `${API_BASE_URL}/search.json?q=${encodeURIComponent(query)}&limit=${limit}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return formatBooks(data.docs);
            } catch (error) {
                console.error('Error fetching books:', error);
                throw error;
            }
        }

        // Fetch trending/popular books
        async function fetchTrendingBooks(subject = 'fiction', limit = 20) {
            try {
                const response = await fetch(
                    `${API_BASE_URL}/subjects/${subject}.json?limit=${limit}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return formatBooksFromSubject(data.works);
            } catch (error) {
                console.error('Error fetching trending books:', error);
                throw error;
            }
        }

        // Format book data from search results
        function formatBooks(docs) {
            return docs.map(doc => ({
                id: doc.key || doc.cover_edition_key || `book-${Math.random()}`,
                title: doc.title || 'Unknown Title',
                author: doc.author_name ? doc.author_name[0] : 'Unknown Author',
                year: doc.first_publish_year || 'N/A',
                cover: doc.cover_i 
                    ? `https://covers.openlibrary.org/b/id/${doc.cover_i}-M.jpg`
                    : 'https://via.placeholder.com/300x400?text=No+Cover',
                isbn: doc.isbn ? doc.isbn[0] : null,
                bookUrl: doc.key ? `https://openlibrary.org${doc.key}` : null
            }));
        }

        // Format book data from subject results
        function formatBooksFromSubject(works) {
            return works.map(work => ({
                id: work.key || `book-${Math.random()}`,
                title: work.title || 'Unknown Title',
                author: work.authors && work.authors[0] ? work.authors[0].name : 'Unknown Author',
                year: work.first_publish_year || 'N/A',
                cover: work.cover_id 
                    ? `https://covers.openlibrary.org/b/id/${work.cover_id}-M.jpg`
                    : 'https://via.placeholder.com/300x400?text=No+Cover',
                bookUrl: work.key ? `https://openlibrary.org${work.key}` : null
            }));
        }

        const fetchBooksModule = {
            searchBooks,
            fetchTrendingBooks
        };

        // ===== favorites.js module =====
        const STORAGE_KEY = 'bookExplorerFavorites';

        function getFavorites() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        function saveFavorites(favorites) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(favorites));
        }

        function addFavorite(book) {
            const favorites = getFavorites();
            const exists = favorites.some(fav => fav.id === book.id);
            
            if (exists) {
                return { success: false, message: 'Book already in favorites!' };
            }
            
            favorites.push(book);
            saveFavorites(favorites);
            return { success: true, message: 'Book added to favorites!' };
        }

        function removeFavorite(bookId) {
            let favorites = getFavorites();
            favorites = favorites.filter(book => book.id !== bookId);
            saveFavorites(favorites);
            return { success: true, message: 'Book removed from favorites!' };
        }

        function isFavorite(bookId) {
            const favorites = getFavorites();
            return favorites.some(book => book.id === bookId);
        }

        const favoritesModule = {
            getFavorites,
            addFavorite,
            removeFavorite,
            isFavorite
        };

        // ===== DOM Elements =====
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const booksGrid = document.getElementById('books-grid');
        const loading = document.getElementById('loading');
        const noResults = document.getElementById('no-results');
        const errorMessage = document.getElementById('error-message');
        const resultsTitle = document.getElementById('results-title');
        const resultsSubtitle = document.getElementById('results-subtitle');
        const browsePopularBtn = document.getElementById('browse-popular-btn');
        const retryBtn = document.getElementById('retry-btn');
        const browseBooksLink = document.querySelector('a[href="#books-grid"]');

        // State
        let currentBooks = [];
        let isSearchMode = false;

        // Mobile menu toggle
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Show notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Update favorites badge in navigation
        function updateFavoritesBadge() {
            const badge = document.getElementById('nav-favorites-badge');
            const count = favoritesModule.getFavorites().length;
            
            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // Toggle UI states (Exercise 3.4)
        function showLoading() {
            loading.classList.remove('hidden');
            booksGrid.classList.add('hidden');
            noResults.classList.add('hidden');
            errorMessage.classList.add('hidden');
        }

        function showBooks() {
            loading.classList.add('hidden');
            booksGrid.classList.remove('hidden');
            noResults.classList.add('hidden');
            errorMessage.classList.add('hidden');
        }

        function showNoResults() {
            loading.classList.add('hidden');
            booksGrid.classList.add('hidden');
            noResults.classList.remove('hidden');
            errorMessage.classList.add('hidden');
        }

        function showError() {
            loading.classList.add('hidden');
            booksGrid.classList.add('hidden');
            noResults.classList.add('hidden');
            errorMessage.classList.remove('hidden');
        }

        // Function to create book card HTML
        function createBookCard(book) {
            const isFav = favoritesModule.isFavorite(book.id);
            
            return `
                <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                    <div class="aspect-w-2 aspect-h-3 bg-gray-200 relative">
                        <img 
                            src="${book.cover}" 
                            alt="${book.title}"
                            class="w-full h-64 object-cover"
                            onerror="this.src='https://via.placeholder.com/300x400?text=No+Cover'"
                        >
                        ${isFav ? '<div class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg></div>' : ''}
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-800 mb-1 line-clamp-2">${book.title}</h3>
                        <p class="text-gray-600 text-sm mb-2">${book.author}</p>
                        <p class="text-gray-500 text-xs mb-3">${book.year}</p>
                        <button 
                            class="favorite-btn w-full ${isFav ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-600 hover:bg-blue-700'} text-white font-semibold py-2 px-4 rounded transition"
                            data-book='${JSON.stringify(book).replace(/'/g, "&apos;")}'
                            data-is-favorite="${isFav}"
                        >
                            ${isFav ? 'Remove from Favorites' : 'Add to Favorites'}
                        </button>
                    </div>
                </div>
            `;
        }

        // Render books on page
        function renderBooks(books) {
            if (books.length === 0) {
                showNoResults();
                return;
            }

            currentBooks = books;
            booksGrid.innerHTML = books.map(book => createBookCard(book)).join('');
            showBooks();
            
            // Add event listeners to favorite buttons
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const book = JSON.parse(e.target.getAttribute('data-book'));
                    const isFav = e.target.getAttribute('data-is-favorite') === 'true';
                    
                    let result;
                    if (isFav) {
                        result = favoritesModule.removeFavorite(book.id);
                        showNotification(result.message, 'success');
                    } else {
                        result = favoritesModule.addFavorite(book);
                        showNotification(result.message, result.success ? 'success' : 'error');
                    }
                    
                    // Re-render to update button states
                    renderBooks(currentBooks);
                    updateFavoritesBadge();
                });
            });
        }

        // Scroll to books grid
        function scrollToBooksGrid() {
            const booksGrid = document.getElementById('books-grid');
            booksGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Exercise 3.3: Search Functionality
        async function performSearch(query) {
            if (!query.trim()) {
                showNotification('Please enter a search term', 'error');
                return;
            }

            isSearchMode = true;
            clearSearchBtn.classList.remove('hidden');
            resultsTitle.textContent = `Search Results for "${query}"`;
            resultsSubtitle.textContent = 'Powered by Open Library';

            showLoading();

            try {
                const books = await fetchBooksModule.searchBooks(query);
                renderBooks(books);
                scrollToBooksGrid();
            } catch (error) {
                showError();
            }
        }

        // Load trending books (Exercise 3.2)
        async function loadTrendingBooks() {
            isSearchMode = false;
            clearSearchBtn.classList.add('hidden');
            resultsTitle.textContent = 'Popular Books';
            resultsSubtitle.textContent = 'Browse our collection of amazing books';
            searchInput.value = '';

            showLoading();

            try {
                const books = await fetchBooksModule.fetchTrendingBooks('fiction', 24);
                renderBooks(books);
                scrollToBooksGrid();
            } catch (error) {
                showError();
            }
        }

        // Event Listeners
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value;
            performSearch(query);
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch(searchInput.value);
            }
        });

        clearSearchBtn.addEventListener('click', loadTrendingBooks);
        browsePopularBtn.addEventListener('click', loadTrendingBooks);
        retryBtn.addEventListener('click', () => {
            if (isSearchMode) {
                performSearch(searchInput.value);
            } else {
                loadTrendingBooks();
            }
        });

        browseBooksLink.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default anchor behavior
            loadTrendingBooks();
        });

        // Initial load
        updateFavoritesBadge();
        loadTrendingBooks();
    </script>
</body>
</html>